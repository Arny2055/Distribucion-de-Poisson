<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Score Lab - BetAGS Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');

        :root { 
            --score-bg: #0b0e11; 
            --score-card: #161a1e; 
            --score-green: #008a4b; 
            --score-amber: #7a5118;
            --score-red: #5c1a1a;
            --score-text-muted: #848d95;
            --score-accent: #3d434a;
        }
        
        body { 
            background-color: var(--score-bg); 
            color: #ffffff; 
            font-family: 'Inter', sans-serif; 
            min-height: 100vh;
        }

        .score-card { 
            background: var(--score-card); 
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .stat-badge {
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: 800;
            text-align: center;
            font-size: 13px;
            min-width: 65px;
        }

        .bg-score-green { background-color: rgba(0, 138, 75, 0.3); color: #00ff88; border: 1px solid rgba(0, 255, 136, 0.2); }
        .bg-score-amber { background-color: rgba(122, 81, 24, 0.3); color: #ffb84d; border: 1px solid rgba(255, 184, 77, 0.2); }
        .bg-score-red { background-color: rgba(92, 26, 26, 0.3); color: #ff5c5c; border: 1px solid rgba(255, 92, 92, 0.2); }

        input { 
            background-color: #1c2127 !important; 
            color: white !important; 
            border: 1px solid #2d343c !important; 
            border-radius: 10px; 
            font-size: 0.9rem; 
        }

        .mode-selector { background: #1c2127; border-radius: 12px; padding: 4px; display: flex; }
        .mode-btn { flex: 1; padding: 10px; font-size: 11px; font-weight: 800; border-radius: 10px; text-align: center; cursor: pointer; color: var(--score-text-muted); transition: 0.3s; }
        .mode-btn.active { background: #3d434a; color: white; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }

        .matrix-cell { 
            padding: 8px; 
            text-align: center; 
            border: 1px solid rgba(255,255,255,0.05); 
            font-size: 10px; 
            border-radius: 8px; 
            background: #1c2127;
        }

        .table-header { color: var(--score-text-muted); font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
        
        .divider { border-bottom: 1px solid rgba(255,255,255,0.05); margin: 15px 0; }
        
        .tab-active { border-bottom: 3px solid #7c3aed; color: #ffffff; }

        /* Estilo Score Lab para los promedios */
        .input-group-label { font-size: 10px; font-weight: 700; color: #848d95; margin-bottom: 6px; text-transform: uppercase; }
    </style>
</head>
<body>
    <nav class="bg-[#0b0e11] border-b border-white/5 p-4 sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2">
                <i class="fa-solid fa-chevron-left text-white/50"></i>
                <h1 class="text-lg font-bold">Chapecoense <span class="text-white/30 mx-1">0 : 0</span> Coritiba</h1>
            </div>
            <div class="bg-red-600 px-2 py-1 rounded text-[10px] font-black uppercase tracking-tighter">32'</div>
        </div>
    </nav>

    <div class="container mx-auto p-4 max-w-6xl">
        <div class="flex gap-6 mb-6 border-b border-white/5 overflow-x-auto whitespace-nowrap scrollbar-hide">
            <span class="pb-3 text-sm font-bold text-white/40">Overview</span>
            <span class="pb-3 text-sm font-bold tab-active">Stats</span>
            <span class="pb-3 text-sm font-bold text-white/40">Lineups</span>
            <span class="pb-3 text-sm font-bold text-white/40">Matches</span>
            <span class="pb-3 text-sm font-bold text-white/40">Compare</span>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            <div class="lg:col-span-4 space-y-4">
                <div class="score-card p-5">
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex items-center gap-2">
                            <div class="w-8 h-8 bg-amber-500/20 rounded-lg flex items-center justify-center">
                                <i class="fa-solid fa-chart-line text-amber-500 text-sm"></i>
                            </div>
                            <h2 class="text-sm font-bold">Over / Under Stats</h2>
                        </div>
                    </div>

                    <div class="mode-selector mb-6">
                        <div onclick="setAnalysisMode('GOLES')" id="mode-goles" class="mode-btn active">OVER</div>
                        <div onclick="setAnalysisMode('XG')" id="mode-xg" class="mode-btn">UNDER</div>
                    </div>

                    <div class="space-y-4">
                        <div>
                            <p class="input-group-label">Local (A Favor)</p>
                            <input type="number" id="h_gf" step="0.01" class="w-full p-4 text-xl font-bold" placeholder="0.00">
                        </div>
                        <div>
                            <p class="input-group-label">Visitante (A Favor)</p>
                            <input type="number" id="a_gf" step="0.01" class="w-full p-4 text-xl font-bold" placeholder="0.00">
                        </div>
                        
                        <div class="pt-2">
                            <button id="calc-btn" onclick="calculatePoisson()" class="w-full bg-[#008a4b] hover:bg-emerald-500 py-4 rounded-xl font-black text-sm uppercase transition-all shadow-lg">
                                Generar An√°lisis
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-8 space-y-4">
                <div class="score-card p-4 overflow-hidden">
                    <div class="flex justify-between items-center mb-4 px-2">
                        <span class="text-[11px] font-black text-white/20 uppercase">Mercado</span>
                        <div class="flex gap-10">
                            <span class="text-[11px] font-black text-emerald-500 uppercase">Local</span>
                            <span class="text-[11px] font-black text-blue-400 uppercase">Visita</span>
                            <span class="text-[11px] font-black text-white/40 uppercase">AVG</span>
                        </div>
                    </div>
                    
                    <div id="market-table" class="space-y-2">
                        <div class="text-center py-10 text-white/20 text-xs italic">Ingresa los promedios para ver las probabilidades de Score Lab</div>
                    </div>
                </div>

                <div class="score-card p-5">
                    <h3 class="text-[11px] font-black text-white/30 uppercase mb-4 tracking-widest">Probabilidades de Marcador Exacto</h3>
                    <div class="grid grid-cols-6 gap-2" id="score-matrix"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentAnalysisMode = 'GOLES';
        let RHO_CORRECTION = -0.11;

        function setAnalysisMode(mode) {
            currentAnalysisMode = mode;
            document.getElementById('mode-goles').classList.toggle('active', mode === 'GOLES');
            document.getElementById('mode-xg').classList.toggle('active', mode === 'XG');
            if(document.getElementById('h_gf').value) calculatePoisson();
        }

        function factorial(n) { return (n <= 1) ? 1 : n * factorial(n - 1); }
        function poissonProb(k, lambda) { return (Math.pow(lambda, k) * Math.exp(-lambda)) / factorial(k); }

        function getDixonColesTau(x, y, lh, la) {
            if (x === 0 && y === 0) return 1 - (lh * la * RHO_CORRECTION);
            if (x === 1 && y === 0) return 1 + (la * RHO_CORRECTION);
            if (x === 0 && y === 1) return 1 + (lh * RHO_CORRECTION);
            if (x === 1 && y === 1) return 1 - RHO_CORRECTION;
            return 1;
        }

        function getBadgeClass(prob) {
            if (prob >= 0.70) return 'bg-score-green';
            if (prob >= 0.40) return 'bg-score-amber';
            return 'bg-score-red';
        }

        function calculatePoisson() {
            const lh = parseFloat(document.getElementById('h_gf').value) || 0;
            const la = parseFloat(document.getElementById('a_gf').value) || 0;

            if(lh <= 0 && la <= 0) return;

            let p_h = [], p_a = [];
            for(let i=0; i<=5; i++) { 
                p_h.push(poissonProb(i, lh)); 
                p_a.push(poissonProb(i, la)); 
            }
            
            // Procesar Mercados Estilo Score Lab
            const markets = [
                { name: '0.5 Over', h: 1 - p_h[0], a: 1 - p_a[0] },
                { name: '1.5 Over', h: 1 - (p_h[0] + p_h[1]), a: 1 - (p_a[0] + p_a[1]) },
                { name: '2.5 Over', h: 1 - (p_h[0] + p_h[1] + p_h[2]), a: 1 - (p_a[0] + p_a[1] + p_a[2]) },
                { name: '3.5 Over', h: 1 - (p_h[0] + p_h[1] + p_h[2] + p_h[3]), a: 1 - (p_a[0] + p_a[1] + p_a[2] + p_a[3]) }
            ];

            const container = document.getElementById('market-table');
            container.innerHTML = '';

            markets.forEach(m => {
                const avg = (m.h + m.a) / 2;
                container.innerHTML += `
                    <div class="flex justify-between items-center p-2 rounded-lg hover:bg-white/5 transition-all">
                        <span class="text-sm font-semibold text-white/70">${m.name}</span>
                        <div class="flex gap-2">
                            <div class="stat-badge ${getBadgeClass(m.h)}">${(m.h * 100).toFixed(0)}%</div>
                            <div class="stat-badge ${getBadgeClass(m.a)}">${(m.a * 100).toFixed(0)}%</div>
                            <div class="stat-badge ${getBadgeClass(avg)}">${(avg * 100).toFixed(0)}%</div>
                        </div>
                    </div>
                `;
            });

            // Matriz de Marcadores
            const matrix = document.getElementById('score-matrix');
            matrix.innerHTML = '';
            for(let h=0; h<=3; h++) {
                for(let a=0; a<=3; a++) {
                    const prob = (p_h[h] * p_a[a]) * getDixonColesTau(h, a, lh, la);
                    const cell = document.createElement('div');
                    cell.className = 'matrix-cell';
                    cell.style.borderLeft = `3px solid ${prob > 0.1 ? '#00ff88' : 'transparent'}`;
                    cell.innerHTML = `<div class="text-white/40 text-[9px] mb-1">${h}-${a}</div><div class="font-bold">${(prob*100).toFixed(1)}%</div>`;
                    matrix.appendChild(cell);
                }
            }
        }
    </script>
</body>
</html>
