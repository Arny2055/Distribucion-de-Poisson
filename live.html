<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BetAGS - Quantum Miner Live</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=UnifrakturMaguntia&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { background-color: #020617; color: #f8fafc; font-family: 'Inter', sans-serif; }
        .glass-card { background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); }
        
        .gothic-font { font-family: 'UnifrakturMaguntia', serif; }

        .input-accent { 
            background: #000; 
            border: 2px solid #1e293b; 
            border-radius: 12px; 
            color: #fff; 
            transition: all 0.3s;
            text-align: center;
            font-weight: 900;
        }
        .input-accent:focus { border-color: #fbbf24; box-shadow: 0 0 15px rgba(251, 191, 36, 0.2); outline: none; }

        .prob-card {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.4), rgba(15, 23, 42, 0.9));
            border: 1px solid rgba(255, 255, 255, 0.03);
            border-radius: 28px;
            padding: 30px;
            position: relative;
            overflow: hidden;
            text-align: center; 
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .alert-active {
            background: linear-gradient(145deg, rgba(16, 185, 129, 0.3), rgba(6, 78, 59, 0.8)) !important;
            border: 2px solid #10b981 !important;
            transform: scale(1.03);
            animation: pulse-alert 2s infinite;
        }

        .insight-alert {
            animation: pulse-gold 1.5s infinite;
            border: 1px solid #fbbf24 !important;
            background: rgba(251, 191, 36, 0.1) !important;
        }

        @keyframes pulse-alert {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
            70% { box-shadow: 0 0 0 20px rgba(16, 185, 129, 0); }
            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }

        @keyframes pulse-gold {
            0% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(251, 191, 36, 0); }
            100% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0); }
        }
        
        .value-large { font-size: 4.5rem; font-weight: 400; line-height: 1; transition: all 0.3s; margin: 15px 0; }
        .value-mid { font-size: 3rem; font-weight: 400; line-height: 1; transition: all 0.3s; margin: 10px 0; }
        .label-mini { font-size: 0.8rem; font-weight: 800; text-transform: uppercase; letter-spacing: 3px; color: #94a3b8; }
        .odd-badge { background: rgba(0,0,0,0.6); padding: 8px 16px; border-radius: 10px; font-family: monospace; font-size: 1.2rem; color: #fbbf24; border: 1px solid rgba(251, 191, 36, 0.2); display: inline-block; }
        
        .glow-ht { text-shadow: 0 0 20px rgba(16, 185, 129, 0.5); color: #10b981; }
        .glow-ft { text-shadow: 0 0 20px rgba(59, 130, 246, 0.5); color: #3b82f6; }
        .glow-btts { text-shadow: 0 0 20px rgba(251, 191, 36, 0.5); color: #fbbf24; }
        .glow-win { text-shadow: 0 0 20px rgba(167, 139, 250, 0.5); color: #a78bfa; }
        
        .status-tag { font-size: 11px; font-weight: 900; padding: 4px 12px; border-radius: 6px; text-transform: uppercase; margin-bottom: 12px; display: inline-block; letter-spacing: 1px; }

        .btn-back {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 800;
            text-transform: uppercase;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #94a3b8;
        }
        .btn-back:hover { background: rgba(255, 255, 255, 0.1); color: #fff; border-color: rgba(251, 191, 36, 0.5); }

        .btn-clear {
            width: 100%; margin-top: 20px; padding: 15px; border-radius: 12px;
            background: rgba(239, 68, 68, 0.05); border: 1px solid rgba(239, 68, 68, 0.2);
            color: #ef4444; font-weight: 800; text-transform: uppercase; letter-spacing: 2px; font-size: 12px; transition: all 0.3s;
        }
        .btn-clear:hover { background: rgba(239, 68, 68, 0.2); border-color: #ef4444; box-shadow: 0 0 20px rgba(239, 68, 68, 0.1); }

        .efficiency-bar-bg { background: rgba(255,255,255,0.05); height: 12px; border-radius: 6px; overflow: hidden; position: relative; }
        .efficiency-fill { height: 100%; transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
        .marker-mid { position: absolute; left: 50%; top: 0; bottom: 0; width: 2px; background: rgba(255,255,255,0.2); z-index: 10; }
        
        .help-step { background: rgba(255,255,255,0.03); border-radius: 15px; padding: 12px; border: 1px solid rgba(255,255,255,0.05); }

        /* Estilo Estrategia */
        #strategy-box {
            background: linear-gradient(135deg, #1e1b4b 0%, #0f172a 100%);
            border: 2px solid #312e81;
            padding: 20px;
            border-radius: 20px;
            text-align: left;
        }
        .strategy-title { font-size: 10px; font-weight: 900; text-transform: uppercase; color: #818cf8; letter-spacing: 2px; margin-bottom: 8px; }
        .strategy-text { font-size: 14px; font-weight: 700; color: #fff; line-height: 1.4; }
    </style>
</head>
<body>
    <nav class="p-4 bg-black/60 border-b border-white/5 backdrop-blur-md sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center gap-6">
                <a href="index.html" class="btn-back">
                    <i class="fa-solid fa-chevron-left text-amber-500"></i>
                    Poisson
                </a>
                <h1 class="text-3xl font-black tracking-tighter italic gothic-font">BetAGS <span class="text-emerald-500">Quantum</span></h1>
            </div>
            <div class="flex items-center gap-4">
                <div class="hidden md:block text-[10px] font-bold bg-emerald-500/10 text-emerald-500 px-3 py-1 rounded-full border border-emerald-500/20 tracking-widest">IA PREDICTIVA LIVE</div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto p-4 max-w-6xl">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
            <div class="help-step flex items-start gap-4">
                <div class="bg-emerald-500/20 text-emerald-500 w-8 h-8 rounded-full flex items-center justify-center font-black shrink-0">1</div>
                <div>
                    <h5 class="text-[11px] font-black uppercase text-emerald-500 mb-1">Carga de Datos</h5>
                    <p class="text-[10px] text-slate-400">Ingresa el minuto actual y los xG/Goles reales de cada equipo.</p>
                </div>
            </div>
            <div class="help-step flex items-start gap-4">
                <div class="bg-amber-500/20 text-amber-500 w-8 h-8 rounded-full flex items-center justify-center font-black shrink-0">2</div>
                <div>
                    <h5 class="text-[11px] font-black uppercase text-amber-500 mb-1">An√°lisis Cu√°ntico</h5>
                    <p class="text-[10px] text-slate-400">Si la barra de eficacia pasa la mitad, el equipo es letal de cara al arco.</p>
                </div>
            </div>
            <div class="help-step flex items-start gap-4">
                <div class="bg-purple-500/20 text-purple-500 w-8 h-8 rounded-full flex items-center justify-center font-black shrink-0">3</div>
                <div>
                    <h5 class="text-[11px] font-black uppercase text-purple-500 mb-1">Se√±al de Valor</h5>
                    <p class="text-[10px] text-slate-400">Cuando una tarjeta parpadee en verde, la probabilidad es alta: ¬°Ojo!</p>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <div class="lg:col-span-1 space-y-4 text-center">
                <div class="glass-card p-8 rounded-3xl border-emerald-500/20 shadow-2xl">
                    <div class="mb-8">
                        <label class="label-mini block mb-4 text-emerald-500">Minuto Actual del Partido</label>
                        <input type="number" id="live-min-start" value="0" min="0" max="90" 
                               class="w-full input-accent py-6 text-6xl gothic-font shadow-inner" 
                               oninput="calculateLive()">
                    </div>

                    <div class="space-y-6">
                        <p class="label-mini border-b border-white/5 pb-2">Datos del Partido (Live)</p>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-white/5 p-3 rounded-2xl">
                                <label class="text-[9px] font-black uppercase text-emerald-400 block mb-2 tracking-widest">Local xG</label>
                                <input type="number" id="manual-xg-h" step="0.1" placeholder="0.0" 
                                       class="w-full input-accent py-2 text-2xl" oninput="calculateLive()">
                            </div>
                            <div class="bg-white/5 p-3 rounded-2xl">
                                <label class="text-[9px] font-black uppercase text-emerald-200 block mb-2 tracking-widest">Local Goles</label>
                                <input type="number" id="manual-g-h" step="1" placeholder="0" 
                                       class="w-full input-accent py-2 text-2xl" oninput="calculateLive()">
                            </div>
                            <div class="bg-white/5 p-3 rounded-2xl">
                                <label class="text-[9px] font-black uppercase text-amber-400 block mb-2 tracking-widest">Visita xG</label>
                                <input type="number" id="manual-xg-a" step="0.1" placeholder="0.0" 
                                       class="w-full input-accent py-2 text-2xl" oninput="calculateLive()">
                            </div>
                            <div class="bg-white/5 p-3 rounded-2xl">
                                <label class="text-[9px] font-black uppercase text-amber-200 block mb-2 tracking-widest">Visita Goles</label>
                                <input type="number" id="manual-g-a" step="1" placeholder="0" 
                                       class="w-full input-accent py-2 text-2xl" oninput="calculateLive()">
                            </div>
                        </div>
                    </div>

                    <div id="quantum-insight-card" class="mt-8 pt-6 border-t border-white/5 space-y-4 rounded-xl transition-all duration-500 p-4">
                        <div class="flex items-center justify-center gap-2 mb-2">
                            <i class="fa-solid fa-atom text-amber-500 animate-spin-slow"></i>
                            <h4 class="text-[10px] font-black text-white uppercase tracking-widest">Monitor de Eficacia</h4>
                        </div>
                        
                        <div class="text-left">
                            <div class="flex justify-between items-end mb-1">
                                <span class="text-[9px] font-bold text-slate-400 uppercase">Poder de Definici√≥n Local</span>
                                <span id="eff-val-h" class="text-[10px] font-black text-emerald-400 bg-emerald-500/10 px-2 rounded">0.00</span>
                            </div>
                            <div class="efficiency-bar-bg">
                                <div class="marker-mid"></div>
                                <div id="eff-bar-h" class="efficiency-fill bg-gradient-to-r from-emerald-900 to-emerald-400" style="width: 0%"></div>
                            </div>
                        </div>

                        <div class="text-left">
                            <div class="flex justify-between items-end mb-1">
                                <span class="text-[9px] font-bold text-slate-400 uppercase">Poder de Definici√≥n Visita</span>
                                <span id="eff-val-a" class="text-[10px] font-black text-amber-400 bg-amber-500/10 px-2 rounded">0.00</span>
                            </div>
                            <div class="efficiency-bar-bg">
                                <div class="marker-mid"></div>
                                <div id="eff-bar-a" class="efficiency-fill bg-gradient-to-r from-amber-900 to-amber-400" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="bg-black/40 p-3 rounded-lg border border-white/5">
                            <p id="quantum-insight" class="text-[10px] font-bold text-slate-300 leading-tight">Analizando inercia del partido...</p>
                        </div>
                    </div>

                    <div id="strategy-box" class="mt-4 border border-indigo-500/30">
                        <div class="strategy-title"><i class="fa-solid fa-chess text-indigo-400 mr-2"></i>Estrategia Recomendada</div>
                        <p id="strategy-output" class="strategy-text italic">Introduce datos para procesar t√°ctica...</p>
                    </div>

                    <button onclick="clearData()" class="btn-clear">
                        <i class="fa-solid fa-trash-can mr-2"></i> Reiniciar Mesa
                    </button>
                </div>
            </div>

            <div class="lg:col-span-2">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div id="card-o05-ht" class="prob-card">
                        <span id="tag-o05-ht" class="status-tag bg-white/5 text-slate-500">Standby</span><br>
                        <span class="label-mini">Over 0.5 HT (1er Tiempo)</span>
                        <div id="prob-o05-ht" class="value-large gothic-font">0%</div>
                        <div class="mt-4"><span id="fair-o05-ht" class="odd-badge">1.00</span></div>
                    </div>

                    <div id="card-o05-ft" class="prob-card">
                        <span id="tag-o05-ft" class="status-tag bg-white/5 text-slate-500">Standby</span><br>
                        <span class="label-mini">Over 0.5 FT (Partido)</span>
                        <div id="prob-o05-ft" class="value-large gothic-font">0%</div>
                        <div class="mt-4"><span id="fair-o05-ft" class="odd-badge">1.00</span></div>
                    </div>

                    <div id="card-o15-ft" class="prob-card">
                        <span id="tag-o15-ft" class="status-tag bg-white/5 text-slate-500">Standby</span><br>
                        <span class="label-mini">Over 1.5 FT</span>
                        <div id="prob-o15-ft" class="value-large gothic-font">0%</div>
                        <div class="mt-4"><span id="fair-o15-ft" class="odd-badge">1.00</span></div>
                    </div>

                    <div id="card-o25-ft" class="prob-card">
                        <span id="tag-o25-ft" class="status-tag bg-white/5 text-slate-500">Standby</span><br>
                        <span class="label-mini">Over 2.5 FT</span>
                        <div id="prob-o25-ft" class="value-large gothic-font">0%</div>
                        <div class="mt-4"><span id="fair-o25-ft" class="odd-badge">1.00</span></div>
                    </div>

                    <div id="card-btts" class="prob-card md:col-span-2">
                        <span id="tag-btts" class="status-tag bg-white/5 text-slate-500">Standby</span><br>
                        <span class="label-mini">Ambos Equipos Anotan</span>
                        <div id="prob-btts" class="value-large gothic-font">0%</div>
                        <div class="mt-4"><span id="fair-btts" class="odd-badge px-10">1.00</span></div>
                    </div>

                    <div class="md:col-span-2 grid grid-cols-3 gap-4">
                        <div id="card-win-h" class="prob-card py-6">
                            <span class="label-mini block mb-2">Victoria Local</span>
                            <div id="prob-win-h" class="value-mid gothic-font glow-win">0%</div>
                            <span id="fair-win-h" class="text-[12px] font-mono text-amber-500">1.00</span>
                        </div>
                        <div id="card-win-d" class="prob-card py-6">
                            <span class="label-mini block mb-2">Empate</span>
                            <div id="prob-win-d" class="value-mid gothic-font glow-win">0%</div>
                            <span id="fair-win-d" class="text-[12px] font-mono text-amber-500">1.00</span>
                        </div>
                        <div id="card-win-a" class="prob-card py-6">
                            <span class="label-mini block mb-2">Victoria Visita</span>
                            <div id="prob-win-a" class="value-mid gothic-font glow-win">0%</div>
                            <span id="fair-win-a" class="text-[12px] font-mono text-amber-500">1.00</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="audio-status" class="fixed bottom-4 right-4 text-[9px] text-slate-600 bg-black/80 px-2 py-1 rounded">Audio: Listo para Alertas</div>

    <script>
        let lastAlertState = false;

        function playQuantumSound() {
            try {
                const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(880, audioCtx.currentTime); 
                oscillator.frequency.exponentialRampToValueAtTime(440, audioCtx.currentTime + 0.5);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.5);
            } catch (e) { console.warn("Audio bloqueado."); }
        }

        function getPoisson(k, lambda) {
            if (lambda <= 0) return k === 0 ? 1 : 0;
            return Math.exp(-lambda + k * Math.log(lambda) - logFactorial(k));
        }

        function logFactorial(n) {
            let res = 0;
            for (let i = 2; i <= n; i++) res += Math.log(i);
            return res;
        }

        function clearData() {
            document.querySelectorAll('input').forEach(i => i.value = (i.id === 'live-min-start' ? 0 : ''));
            calculateLive();
        }

        function calculateLive() {
            const xgH = parseFloat(document.getElementById('manual-xg-h').value) || 0;
            const gH = parseFloat(document.getElementById('manual-g-h').value) || 0;
            const xgA = parseFloat(document.getElementById('manual-xg-a').value) || 0;
            const gA = parseFloat(document.getElementById('manual-g-a').value) || 0;
            const currentMin = parseInt(document.getElementById('live-min-start').value) || 0;
            
            const wXG = 0.7, wG = 0.3;
            const effAttH = (xgH * wXG) + (gH * wG);
            const effAttA = (xgA * wXG) + (gA * wG);

            const effH = xgH > 0 ? (gH / xgH) : 0;
            const effA = xgA > 0 ? (gA / xgA) : 0;

            updateEfficiency(xgH, gH, xgA, gA);

            const remFT = Math.max(0, 90 - currentMin);
            const lambdaH = effAttH * (remFT / 90);
            const lambdaA = effAttA * (remFT / 90);
            const totalLambda = lambdaH + lambdaA;

            const p05ft = 1 - getPoisson(0, totalLambda);
            const p15ft = 1 - (getPoisson(0, totalLambda) + getPoisson(1, totalLambda));
            const p25ft = 1 - (getPoisson(0, totalLambda) + getPoisson(1, totalLambda) + getPoisson(2, totalLambda));
            const pBTTS = (1 - Math.exp(-lambdaH)) * (1 - Math.exp(-lambdaA));

            let winH = 0, draw = 0, winA = 0;
            for (let i = 0; i <= 6; i++) {
                for (let j = 0; j <= 6; j++) {
                    const p = getPoisson(i, lambdaH) * getPoisson(j, lambdaA);
                    if (i > j) winH += p; else if (i === j) draw += p; else winA += p;
                }
            }

            updateMarket('o05-ft', p05ft, 0.85, 'glow-ft');
            updateMarket('o15-ft', p15ft, 0.75, 'glow-ft');
            updateMarket('o25-ft', p25ft, 0.50, 'glow-ft');
            updateMarket('btts', pBTTS, 0.55, 'glow-btts');
            updateMarket('win-h', winH, 0.60, 'glow-win');
            updateMarket('win-d', draw, 0.30, 'glow-win');
            updateMarket('win-a', winA, 0.60, 'glow-win');

            // ACTUALIZAR ESTRATEGIA
            updateStrategy(p05ft, p15ft, pBTTS, winH, draw, winA, currentMin, effH, effA);
        }

        function updateStrategy(p05, p15, btts, wH, wD, wA, min, effH, effA) {
            const strategyOutput = document.getElementById('strategy-output');
            
            if (min === 0 && p05 === 0) {
                strategyOutput.innerText = "Esperando datos para procesar t√°ctica...";
                return;
            }

            let advice = "";
            // L√≥gica de Goles
            if (min < 70 && p05 > 0.88 && (effH > 1.1 || effA > 1.1)) {
                advice = "üî• ESTRATEGIA: Entrar a Over 0.5 FT inmediatamente. Los datos muestran alta probabilidad de gol inminente.";
            } else if (min > 30 && min < 45 && p05 < 0.30) {
                advice = "üõ°Ô∏è ESTRATEGIA: Under 1.5 HT detectado. Partido muy cerrado en medio campo.";
            } else if (btts > 0.65 && p15 > 0.75) {
                advice = "‚öΩ ESTRATEGIA: Ambos Anotan (BTTS) tiene valor cu√°ntico. Ambos equipos est√°n atacando.";
            } else if (min > 75 && wD > 0.45) {
                advice = "ü§ù ESTRATEGIA: El Empate se est√° consolidando estad√≠sticamente. Considerar cerrar posiciones.";
            } else if (wH > 0.75 && effH > 1.2) {
                advice = "üè† ESTRATEGIA: Local Dominante. Handicap Asi√°tico -0.5 o victoria simple tiene valor.";
            } else if (wA > 0.75 && effA > 1.2) {
                advice = "üöÄ ESTRATEGIA: Visita Imparable. El visitante est√° rompiendo l√≠neas con facilidad.";
            } else {
                advice = "‚öñÔ∏è ESTRATEGIA: Mercado equilibrado. Esperar a que la cuota suba o que cambie la inercia (min 70).";
            }

            strategyOutput.innerText = advice;
        }

        function updateEfficiency(xh, gh, xa, ga) {
            const effH = xh > 0 ? (gh / xh) : 0;
            const effA = xa > 0 ? (ga / xa) : 0;
            const card = document.getElementById('quantum-insight-card');
            const insight = document.getElementById('quantum-insight');

            document.getElementById('eff-val-h').innerText = effH.toFixed(2);
            document.getElementById('eff-val-a').innerText = effA.toFixed(2);
            document.getElementById('eff-bar-h').style.width = Math.min(effH * 50, 100) + "%";
            document.getElementById('eff-bar-a').style.width = Math.min(effA * 50, 100) + "%";

            let alert = false;
            if(xh + xa > 0) {
                if(effH > 1.3 || effA > 1.3) {
                    insight.innerHTML = `<span class="text-amber-400">‚ö†Ô∏è ALERTA:</span> Alta eficacia detectada. El marcador podr√≠a moverse pronto.`;
                    alert = true;
                } else if (effH < 0.7 && effA < 0.7) {
                    insight.innerText = "‚õî BAJA EFICACIA: Falta de punter√≠a o partido muy t√°ctico.";
                } else {
                    insight.innerText = "‚úÖ FLUJO ESTABLE: El partido sigue la tendencia esperada.";
                }
            }

            if(alert) {
                card.classList.add('insight-alert');
                if(!lastAlertState) playQuantumSound();
            } else card.classList.remove('insight-alert');
            lastAlertState = alert;
        }

        function updateMarket(id, value, threshold, glowClass) {
            const card = document.getElementById(`card-${id}`);
            const probText = document.getElementById(`prob-${id}`);
            const fairOddText = document.getElementById(`fair-${id}`);
            const tag = document.getElementById(`tag-${id}`);
            
            probText.innerText = (value * 100).toFixed(1) + "%";
            fairOddText.innerText = value > 0.01 ? (1 / value).toFixed(2) : "---";
            probText.className = `gothic-font ${value > 0 ? glowClass : ''} ${id.includes('win') ? 'value-mid' : 'value-large'}`;

            if (value >= threshold && value > 0) {
                card.classList.add('alert-active');
                if(tag) { tag.innerText = "ALERTA DE VALOR"; tag.className = "status-tag bg-emerald-500 text-black"; }
            } else {
                card.classList.remove('alert-active');
                if(tag) { tag.innerText = value <= 0 ? "CERRADO" : "NORMAL"; tag.className = "status-tag bg-white/5 text-slate-500"; }
            }
        }

        window.onload = calculateLive;
    </script>
</body>
</html>