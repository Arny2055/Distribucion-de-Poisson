<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BetAGS - Quantum Miner Live</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=UnifrakturMaguntia&display=swap" rel="stylesheet">
    <style>
        body { background-color: #020617; color: #f8fafc; font-family: 'Inter', sans-serif; }
        .glass-card { background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); }
        
        /* Estilo Gótico para títulos y valores */
        .gothic-font { font-family: 'UnifrakturMaguntia', serif; }

        .input-accent { 
            background: #000; 
            border: 2px solid #1e293b; 
            border-radius: 12px; 
            color: #fff; 
            transition: all 0.3s;
            text-align: center;
            font-weight: 900;
        }
        .input-accent:focus { border-color: #fbbf24; box-shadow: 0 0 15px rgba(251, 191, 36, 0.2); outline: none; }

        .prob-card {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.4), rgba(15, 23, 42, 0.9));
            border: 1px solid rgba(255, 255, 255, 0.03);
            border-radius: 28px;
            padding: 30px;
            position: relative;
            overflow: hidden;
            text-align: center; 
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .alert-active {
            background: linear-gradient(145deg, rgba(16, 185, 129, 0.3), rgba(6, 78, 59, 0.8)) !important;
            border: 2px solid #10b981 !important;
            transform: scale(1.03);
            animation: pulse-alert 2s infinite;
        }

        /* Alerta de Insight Cuántico */
        .insight-alert {
            animation: pulse-gold 1.5s infinite;
            border: 1px solid #fbbf24 !important;
            background: rgba(251, 191, 36, 0.1) !important;
        }

        @keyframes pulse-alert {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
            70% { box-shadow: 0 0 0 20px rgba(16, 185, 129, 0); }
            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }

        @keyframes pulse-gold {
            0% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(251, 191, 36, 0); }
            100% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0); }
        }
        
        .value-large { font-size: 4.5rem; font-weight: 400; line-height: 1; transition: all 0.3s; margin: 15px 0; }
        .label-mini { font-size: 0.8rem; font-weight: 800; text-transform: uppercase; letter-spacing: 3px; color: #94a3b8; }
        .odd-badge { background: rgba(0,0,0,0.6); padding: 8px 16px; border-radius: 10px; font-family: monospace; font-size: 1.2rem; color: #fbbf24; border: 1px solid rgba(251, 191, 36, 0.2); display: inline-block; }
        
        .glow-ht { text-shadow: 0 0 20px rgba(16, 185, 129, 0.5); color: #10b981; }
        .glow-ft { text-shadow: 0 0 20px rgba(59, 130, 246, 0.5); color: #3b82f6; }
        .glow-btts { text-shadow: 0 0 20px rgba(251, 191, 36, 0.5); color: #fbbf24; }
        
        .status-tag { font-size: 11px; font-weight: 900; padding: 4px 12px; border-radius: 6px; text-transform: uppercase; margin-bottom: 12px; display: inline-block; letter-spacing: 1px; }

        .btn-back {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 800;
            text-transform: uppercase;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #94a3b8;
        }
        .btn-back:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border-color: rgba(251, 191, 36, 0.5);
        }

        .btn-clear {
            width: 100%;
            margin-top: 20px;
            padding: 15px;
            border-radius: 12px;
            background: rgba(239, 68, 68, 0.05);
            border: 1px solid rgba(239, 68, 68, 0.2);
            color: #ef4444;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 12px;
            transition: all 0.3s;
        }
        .btn-clear:hover {
            background: rgba(239, 68, 68, 0.2);
            border-color: #ef4444;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.1);
        }

        .efficiency-bar-bg { background: rgba(255,255,255,0.05); height: 8px; border-radius: 4px; overflow: hidden; }
        .efficiency-fill { height: 100%; transition: width 0.5s ease; }
    </style>
</head>
<body>
    <nav class="p-4 bg-black/60 border-b border-white/5 backdrop-blur-md sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center gap-6">
                <a href="index.html" class="btn-back">
                    <i class="fa-solid fa-chevron-left text-amber-500"></i>
                    Poisson
                </a>
                <h1 class="text-3xl font-black tracking-tighter italic gothic-font">BetAGS <span class="text-emerald-500">Quantum</span></h1>
            </div>
            <div class="flex items-center gap-4">
                <div class="text-[10px] font-bold bg-emerald-500/10 text-emerald-500 px-3 py-1 rounded-full border border-emerald-500/20">XG (70%) + GOALS (30%) ENGINE</div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto p-4 max-w-6xl">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <div class="lg:col-span-1 space-y-4 text-center">
                <div class="glass-card p-8 rounded-3xl border-emerald-500/20 shadow-2xl">
                    <div class="mb-8">
                        <label class="label-mini block mb-4 text-emerald-500">Minuto de Entrada</label>
                        <input type="number" id="live-min-start" value="0" min="0" max="90" 
                               class="w-full input-accent py-6 text-6xl gothic-font shadow-inner" 
                               oninput="calculateLive()">
                    </div>

                    <div class="space-y-6">
                        <p class="label-mini border-b border-white/5 pb-2">Estadísticas Local</p>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-[10px] font-black uppercase text-slate-400 block mb-2">xG Marcado</label>
                                <input type="number" id="manual-xg-h" step="0.1" placeholder="0.0" 
                                       class="w-full input-accent py-4 text-3xl text-emerald-400 gothic-font" oninput="calculateLive()">
                            </div>
                            <div>
                                <label class="text-[10px] font-black uppercase text-slate-400 block mb-2">Goles Marcados</label>
                                <input type="number" id="manual-g-h" step="1" placeholder="0" 
                                       class="w-full input-accent py-4 text-3xl text-emerald-200 gothic-font" oninput="calculateLive()">
                            </div>
                            <div>
                                <label class="text-[10px] font-black uppercase text-slate-400 block mb-2">xGA Recibido</label>
                                <input type="number" id="manual-xga-h" step="0.1" placeholder="0.0" 
                                       class="w-full input-accent py-4 text-3xl text-red-400 gothic-font" oninput="calculateLive()">
                            </div>
                            <div>
                                <label class="text-[10px] font-black uppercase text-slate-400 block mb-2">Goles Recibidos</label>
                                <input type="number" id="manual-gr-h" step="1" placeholder="0" 
                                       class="w-full input-accent py-4 text-3xl text-red-200 gothic-font" oninput="calculateLive()">
                            </div>
                        </div>

                        <p class="label-mini border-b border-white/5 pb-2 pt-4">Estadísticas Visita</p>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-[10px] font-black uppercase text-slate-400 block mb-2">xG Marcado</label>
                                <input type="number" id="manual-xg-a" step="0.1" placeholder="0.0" 
                                       class="w-full input-accent py-4 text-3xl text-amber-400 gothic-font" oninput="calculateLive()">
                            </div>
                            <div>
                                <label class="text-[10px] font-black uppercase text-slate-400 block mb-2">Goles Marcados</label>
                                <input type="number" id="manual-g-a" step="1" placeholder="0" 
                                       class="w-full input-accent py-4 text-3xl text-amber-200 gothic-font" oninput="calculateLive()">
                            </div>
                            <div>
                                <label class="text-[10px] font-black uppercase text-slate-400 block mb-2">xGA Recibido</label>
                                <input type="number" id="manual-xga-a" step="0.1" placeholder="0.0" 
                                       class="w-full input-accent py-4 text-3xl text-red-400 gothic-font" oninput="calculateLive()">
                            </div>
                            <div>
                                <label class="text-[10px] font-black uppercase text-slate-400 block mb-2">Goles Recibidos</label>
                                <input type="number" id="manual-gr-a" step="1" placeholder="0" 
                                       class="w-full input-accent py-4 text-3xl text-red-200 gothic-font" oninput="calculateLive()">
                            </div>
                        </div>
                    </div>

                    <div id="quantum-insight-card" class="mt-8 pt-6 border-t border-white/5 space-y-4 rounded-xl transition-all duration-500">
                        <h4 class="text-[10px] font-black text-amber-500 uppercase tracking-widest">Análisis de Eficiencia Quantum</h4>
                        
                        <div class="text-left px-2">
                            <div class="flex justify-between items-end mb-1">
                                <span class="text-[9px] font-bold text-slate-400">EFICACIA LOCAL</span>
                                <span id="eff-val-h" class="text-[10px] font-black text-emerald-400">0.0</span>
                            </div>
                            <div class="efficiency-bar-bg">
                                <div id="eff-bar-h" class="efficiency-fill bg-emerald-500" style="width: 0%"></div>
                            </div>
                        </div>

                        <div class="text-left px-2">
                            <div class="flex justify-between items-end mb-1">
                                <span class="text-[9px] font-bold text-slate-400">EFICACIA VISITA</span>
                                <span id="eff-val-a" class="text-[10px] font-black text-amber-400">0.0</span>
                            </div>
                            <div class="efficiency-bar-bg">
                                <div id="eff-bar-a" class="efficiency-fill bg-amber-500" style="width: 0%"></div>
                            </div>
                        </div>
                        <p id="quantum-insight" class="text-[9px] italic text-slate-500 mt-2 leading-tight px-2">Introduce datos para generar el insight cuántico...</p>
                    </div>

                    <button onclick="clearData()" class="btn-clear">
                        <i class="fa-solid fa-trash-can mr-2"></i> Limpiar Datos
                    </button>
                </div>
            </div>

            <div class="lg:col-span-2">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    
                    <div id="card-o05-ht" class="prob-card">
                        <span id="tag-o05-ht" class="status-tag bg-white/5 text-slate-500">Standby</span><br>
                        <span class="label-mini">Over 0.5 HT</span>
                        <div id="prob-o05-ht" class="value-large gothic-font">0%</div>
                        <div class="mt-4">
                            <p class="text-[11px] font-black text-slate-500 uppercase mb-2">Cuota Justa</p>
                            <span id="fair-o05-ht" class="odd-badge">1.00</span>
                        </div>
                    </div>

                    <div id="card-o05-ft" class="prob-card">
                        <span id="tag-o05-ft" class="status-tag bg-white/5 text-slate-500">Standby</span><br>
                        <span class="label-mini">Over 0.5 FT</span>
                        <div id="prob-o05-ft" class="value-large gothic-font">0%</div>
                        <div class="mt-4">
                            <p class="text-[11px] font-black text-slate-500 uppercase mb-2">Cuota Justa</p>
                            <span id="fair-o05-ft" class="odd-badge">1.00</span>
                        </div>
                    </div>

                    <div id="card-o15-ft" class="prob-card">
                        <span id="tag-o15-ft" class="status-tag bg-white/5 text-slate-500">Standby</span><br>
                        <span class="label-mini">Over 1.5 FT</span>
                        <div id="prob-o15-ft" class="value-large gothic-font">0%</div>
                        <div class="mt-4">
                            <p class="text-[11px] font-black text-slate-500 uppercase mb-2">Cuota Justa</p>
                            <span id="fair-o15-ft" class="odd-badge">1.00</span>
                        </div>
                    </div>

                    <div id="card-o25-ft" class="prob-card">
                        <span id="tag-o25-ft" class="status-tag bg-white/5 text-slate-500">Standby</span><br>
                        <span class="label-mini">Over 2.5 FT</span>
                        <div id="prob-o25-ft" class="value-large gothic-font">0%</div>
                        <div class="mt-4">
                            <p class="text-[11px] font-black text-slate-500 uppercase mb-2">Cuota Justa</p>
                            <span id="fair-o25-ft" class="odd-badge">1.00</span>
                        </div>
                    </div>

                    <div id="card-btts" class="prob-card md:col-span-2">
                        <span id="tag-btts" class="status-tag bg-white/5 text-slate-500">Standby</span><br>
                        <span class="label-mini">Ambos Equipos Anotan (BTTS)</span>
                        <div id="prob-btts" class="value-large gothic-font">0%</div>
                        <div class="mt-4">
                            <p class="text-[11px] font-black text-slate-500 uppercase mb-2">Cuota Justa</p>
                            <span id="fair-btts" class="odd-badge px-10">1.00</span>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <script>
        let lastAlertState = false;

        function playQuantumSound() {
            try {
                const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();

                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(880, audioCtx.currentTime); // Nota A5
                oscillator.frequency.exponentialRampToValueAtTime(440, audioCtx.currentTime + 0.5);

                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);

                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);

                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.5);
            } catch (e) { console.log("Audio alert blocked by browser"); }
        }

        function getPoisson(k, lambda) {
            if (lambda <= 0) return k === 0 ? 1 : 0;
            const logExp = -lambda + k * Math.log(lambda) - logFactorial(k);
            return Math.exp(logExp);
        }

        function logFactorial(n) {
            let res = 0;
            for (let i = 2; i <= n; i++) res += Math.log(i);
            return res;
        }

        function clearData() {
            document.getElementById('live-min-start').value = 0;
            document.getElementById('manual-xg-h').value = '';
            document.getElementById('manual-g-h').value = '';
            document.getElementById('manual-xga-h').value = '';
            document.getElementById('manual-gr-h').value = '';
            document.getElementById('manual-xg-a').value = '';
            document.getElementById('manual-g-a').value = '';
            document.getElementById('manual-xga-a').value = '';
            document.getElementById('manual-gr-a').value = '';
            calculateLive();
        }

        function calculateLive() {
            const xgH = parseFloat(document.getElementById('manual-xg-h').value) || 0;
            const gH = parseFloat(document.getElementById('manual-g-h').value) || 0;
            const xgaH = parseFloat(document.getElementById('manual-xga-h').value) || 0;
            const grH = parseFloat(document.getElementById('manual-gr-h').value) || 0;
            const xgA = parseFloat(document.getElementById('manual-xg-a').value) || 0;
            const gA = parseFloat(document.getElementById('manual-g-a').value) || 0;
            const xgaA = parseFloat(document.getElementById('manual-xga-a').value) || 0;
            const grA = parseFloat(document.getElementById('manual-gr-a').value) || 0;
            
            const currentMin = parseInt(document.getElementById('live-min-start').value) || 0;
            
            const wXG = 0.7;
            const wG = 0.3;

            const effectiveAttH = (xgH * wXG) + (gH * wG);
            const effectiveDefH = (xgaH * wXG) + (grH * wG);
            const effectiveAttA = (xgA * wXG) + (gA * wG);
            const effectiveDefA = (xgaA * wXG) + (grA * wG);

            updateEfficiency(xgH, gH, xgA, gA);

            const expH = (effectiveAttH + effectiveDefA) / 2;
            const expA = (effectiveAttA + effectiveDefH) / 2;
            const totalExp = expH + expA;

            const remHT = Math.max(0, 45 - currentMin);
            const remFT = Math.max(0, 90 - currentMin);

            const lambdaHT = totalExp * (remHT / 90);
            const lambdaFT = totalExp * (remFT / 90);
            const lambdaH_FT = expH * (remFT / 90);
            const lambdaA_FT = expA * (remFT / 90);

            const p05ht = currentMin >= 45 ? 0 : (1 - getPoisson(0, lambdaHT));
            const p05ft = 1 - getPoisson(0, lambdaFT);
            const p15ft = 1 - (getPoisson(0, lambdaFT) + getPoisson(1, lambdaFT));
            const p25ft = 1 - (getPoisson(0, lambdaFT) + getPoisson(1, lambdaFT) + getPoisson(2, lambdaFT));
            const pBTTS = (1 - Math.exp(-lambdaH_FT)) * (1 - Math.exp(-lambdaA_FT));

            updateMarket('o05-ht', p05ht, 0.70, 'glow-ht');
            updateMarket('o05-ft', p05ft, 0.90, 'glow-ft');
            updateMarket('o15-ft', p15ft, 0.80, 'glow-ft');
            updateMarket('o25-ft', p25ft, 0.55, 'glow-ft');
            updateMarket('btts', pBTTS, 0.60, 'glow-btts');
        }

        function updateEfficiency(xh, gh, xa, ga) {
            const effH = xh > 0 ? (gh / xh) : 0;
            const effA = xa > 0 ? (ga / xa) : 0;
            const insightCard = document.getElementById('quantum-insight-card');

            document.getElementById('eff-val-h').innerText = effH.toFixed(2);
            document.getElementById('eff-val-a').innerText = effA.toFixed(2);

            document.getElementById('eff-bar-h').style.width = Math.min(effH * 50, 100) + "%";
            document.getElementById('eff-bar-a').style.width = Math.min(effA * 50, 100) + "%";

            const insight = document.getElementById('quantum-insight');
            let currentAlert = false;

            if(xh + xa > 0) {
                if(effH > 1.2 && effA > 1.2) insight.innerText = "ALTA FINALIZACIÓN: Ambos equipos están siendo letales con pocas chances.";
                else if(effH < 0.8 && effA < 0.8) insight.innerText = "BLOQUEO CUÁNTICO: Muchos ataques pero fallos masivos en definición.";
                else if(effH > 1.5 || effA > 1.5) {
                    insight.innerText = effH > 1.5 ? "ALERTA: LOCAL OVERPERFORMING CRÍTICO." : "ALERTA: VISITA OVERPERFORMING CRÍTICO.";
                    currentAlert = true;
                }
                else insight.innerText = "PROCESO NORMAL: Los goles están alineados con la creación de xG.";
            }

            if(currentAlert) {
                insightCard.classList.add('insight-alert');
                if(!lastAlertState) playQuantumSound();
            } else {
                insightCard.classList.remove('insight-alert');
            }
            lastAlertState = currentAlert;
        }

        function updateMarket(id, value, threshold, glowClass) {
            const card = document.getElementById(`card-${id}`);
            const probText = document.getElementById(`prob-${id}`);
            const fairOddText = document.getElementById(`fair-${id}`);
            const tag = document.getElementById(`tag-${id}`);
            
            const perc = value * 100;
            probText.innerText = perc.toFixed(1) + "%";
            fairOddText.innerText = value > 0.01 ? (1 / value).toFixed(2) : "---";

            probText.classList.remove('glow-ht', 'glow-ft', 'glow-btts');

            if (value >= threshold && value > 0) {
                card.classList.add('alert-active');
                if(tag) {
                    tag.innerText = "ALERTA: VALOR DETECTADO";
                    tag.className = "status-tag bg-emerald-500 text-black";
                }
                probText.style.color = "#ffffff";
            } else {
                card.classList.remove('alert-active');
                if(tag) {
                    tag.innerText = value <= 0 ? "CERRADO" : "NORMAL";
                    tag.className = "status-tag bg-white/5 text-slate-500";
                }
                probText.style.color = ""; 
                if (value > 0) probText.classList.add(glowClass);
            }
            card.style.opacity = (value <= 0 && (id.includes('ht') || id.includes('ft'))) ? "0.3" : "1";
        }

        window.onload = calculateLive;
    </script>
</body>
</html>