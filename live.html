<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BetAGS - Quantum Miner Live</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background-color: #020617; color: #f8fafc; font-family: 'Inter', sans-serif; }
        .glass-card { background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); }
        
        .input-accent { 
            background: #000; 
            border: 2px solid #1e293b; 
            border-radius: 12px; 
            color: #fff; 
            transition: all 0.3s;
            text-align: center;
            font-weight: 900;
        }
        .input-accent:focus { border-color: #fbbf24; box-shadow: 0 0 15px rgba(251, 191, 36, 0.2); outline: none; }

        .prob-card {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.4), rgba(15, 23, 42, 0.9));
            border: 1px solid rgba(255, 255, 255, 0.03);
            border-radius: 24px;
            padding: 24px;
            position: relative;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Sistema de Alertas */
        .alert-active {
            background: linear-gradient(145deg, rgba(16, 185, 129, 0.2), rgba(6, 78, 59, 0.6)) !important;
            border: 2px solid #10b981 !important;
            transform: scale(1.02);
            animation: pulse-alert 2s infinite;
        }

        @keyframes pulse-alert {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
            70% { box-shadow: 0 0 0 15px rgba(16, 185, 129, 0); }
            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }
        
        .value-large { font-size: 3.8rem; font-weight: 900; letter-spacing: -2px; line-height: 1; transition: all 0.3s; }
        .label-mini { font-size: 0.75rem; font-weight: 800; text-transform: uppercase; letter-spacing: 2px; color: #94a3b8; }
        .odd-badge { background: rgba(0,0,0,0.5); padding: 6px 12px; border-radius: 8px; font-family: monospace; font-size: 1rem; color: #fbbf24; border: 1px solid rgba(251, 191, 36, 0.3); }
        
        .glow-ht { text-shadow: 0 0 20px rgba(16, 185, 129, 0.4); color: #10b981; }
        .glow-ft { text-shadow: 0 0 20px rgba(59, 130, 246, 0.4); color: #3b82f6; }
        .glow-btts { text-shadow: 0 0 20px rgba(251, 191, 36, 0.4); color: #fbbf24; }
        
        .status-tag { font-size: 10px; font-weight: 900; padding: 2px 8px; border-radius: 4px; text-transform: uppercase; margin-bottom: 8px; display: inline-block; }
    </style>
</head>
<body>
    <nav class="p-4 bg-black/60 border-b border-white/5 backdrop-blur-md sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-black tracking-tighter italic">BETAGS <span class="text-emerald-500">QUANTUM</span> <span class="text-slate-600 text-sm">v2.0</span></h1>
            <div class="flex items-center gap-4">
                <div class="text-[10px] font-bold bg-emerald-500/10 text-emerald-500 px-3 py-1 rounded-full border border-emerald-500/20">LIVE ACTIVE</div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto p-4 max-w-6xl">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <div class="lg:col-span-1 space-y-4">
                <div class="glass-card p-6 rounded-3xl border-emerald-500/20">
                    <div class="mb-8">
                        <label class="label-mini block mb-3 text-center text-emerald-500"><i class="fa-solid fa-clock mr-2"></i>Minuto de Entrada</label>
                        <input type="number" id="live-min-start" value="0" min="0" max="90" 
                               class="w-full input-accent py-6 text-6xl shadow-inner" 
                               oninput="calculateLive()">
                    </div>

                    <div class="space-y-6">
                        <p class="label-mini text-center border-b border-white/5 pb-2">Parámetros xG del Partido</p>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-[10px] font-black uppercase text-slate-400 block mb-2 text-center">xG Local</label>
                                <input type="number" id="manual-xg-h" step="0.1" placeholder="1.20" 
                                       class="w-full input-accent py-4 text-3xl text-emerald-400" oninput="calculateLive()">
                            </div>
                            <div>
                                <label class="text-[10px] font-black uppercase text-slate-400 block mb-2 text-center">xG Visita</label>
                                <input type="number" id="manual-xg-a" step="0.1" placeholder="0.80" 
                                       class="w-full input-accent py-4 text-3xl text-amber-400" oninput="calculateLive()">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="p-4 bg-emerald-500/5 border border-emerald-500/10 rounded-2xl">
                    <p class="text-[11px] text-emerald-500 font-medium leading-relaxed">
                        <i class="fa-solid fa-bolt-lightning mr-2"></i><strong>Smart Alert:</strong> Las tarjetas se iluminarán en verde cuando se detecte una probabilidad de alto valor estadístico.
                    </p>
                </div>
            </div>

            <div class="lg:col-span-2">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    
                    <div id="card-o05-ht" class="prob-card">
                        <div class="flex justify-between items-start">
                            <span class="label-mini">Over 0.5 HT</span>
                            <span id="tag-o05-ht" class="status-tag bg-white/5 text-slate-500">Calculando</span>
                        </div>
                        <div id="prob-o05-ht" class="value-large glow-ht">0%</div>
                        <div class="flex justify-between items-center mt-4">
                            <span class="text-[11px] font-black text-slate-500 uppercase">Cuota Justa</span>
                            <span id="fair-o05-ht" class="odd-badge">1.00</span>
                        </div>
                    </div>

                    <div id="card-o15-ht" class="prob-card">
                        <div class="flex justify-between items-start">
                            <span class="label-mini">Over 1.5 HT</span>
                            <span id="tag-o15-ht" class="status-tag bg-white/5 text-slate-500">Normal</span>
                        </div>
                        <div id="prob-o15-ht" class="value-large glow-ht">0%</div>
                        <div class="flex justify-between items-center mt-4">
                            <span class="text-[11px] font-black text-slate-500 uppercase">Cuota Justa</span>
                            <span id="fair-o15-ht" class="odd-badge">1.00</span>
                        </div>
                    </div>

                    <div id="card-o15-ft" class="prob-card">
                        <div class="flex justify-between items-start">
                            <span class="label-mini">Over 1.5 FT (Live)</span>
                            <span id="tag-o15-ft" class="status-tag bg-white/5 text-slate-500">Analizando</span>
                        </div>
                        <div id="prob-o15-ft" class="value-large glow-ft">0%</div>
                        <div class="flex justify-between items-center mt-4">
                            <span class="text-[11px] font-black text-slate-500 uppercase">Cuota Justa</span>
                            <span id="fair-o15-ft" class="odd-badge">1.00</span>
                        </div>
                    </div>

                    <div id="card-o25-ft" class="prob-card">
                        <div class="flex justify-between items-start">
                            <span class="label-mini">Over 2.5 FT (Live)</span>
                            <span id="tag-o25-ft" class="status-tag bg-white/5 text-slate-500">Esperando</span>
                        </div>
                        <div id="prob-o25-ft" class="value-large glow-ft">0%</div>
                        <div class="flex justify-between items-center mt-4">
                            <span class="text-[11px] font-black text-slate-500 uppercase">Cuota Justa</span>
                            <span id="fair-o25-ft" class="odd-badge">1.00</span>
                        </div>
                    </div>

                    <div id="card-btts" class="prob-card md:col-span-2 bg-gradient-to-r from-amber-500/10 to-transparent">
                        <div class="flex justify-between items-start">
                            <div>
                                <span class="label-mini">Ambos Equipos Anotan (BTTS)</span>
                                <div id="prob-btts" class="value-large glow-btts">0%</div>
                            </div>
                            <div class="text-right">
                                <span class="text-[11px] font-black text-slate-500 block mb-2 uppercase">Cuota Recomendada</span>
                                <span id="fair-btts" class="odd-badge text-2xl px-6 py-2">1.00</span>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <script>
        function getPoisson(k, lambda) {
            if (lambda <= 0) return k === 0 ? 1 : 0;
            const logExp = -lambda + k * Math.log(lambda) - logFactorial(k);
            return Math.exp(logExp);
        }

        function logFactorial(n) {
            let res = 0;
            for (let i = 2; i <= n; i++) res += Math.log(i);
            return res;
        }

        function calculateLive() {
            const xgH = parseFloat(document.getElementById('manual-xg-h').value) || 0;
            const xgA = parseFloat(document.getElementById('manual-xg-a').value) || 0;
            const currentMin = parseInt(document.getElementById('live-min-start').value) || 0;
            
            const totalXG = xgH + xgA;
            const remHT = Math.max(0, 45 - currentMin);
            const remFT = Math.max(0, 90 - currentMin);

            const lambdaHT = totalXG * (remHT / 90);
            const lambdaFT = totalXG * (remFT / 90);
            const lambdaH_FT = xgH * (remFT / 90);
            const lambdaA_FT = xgA * (remFT / 90);

            // Mercados
            const p05ht = currentMin >= 45 ? 0 : (1 - getPoisson(0, lambdaHT));
            const p15ht = currentMin >= 45 ? 0 : (1 - (getPoisson(0, lambdaHT) + getPoisson(1, lambdaHT)));
            const p15ft = 1 - (getPoisson(0, lambdaFT) + getPoisson(1, lambdaFT));
            const p25ft = 1 - (getPoisson(0, lambdaFT) + getPoisson(1, lambdaFT) + getPoisson(2, lambdaFT));
            const pBTTS = (1 - Math.exp(-lambdaH_FT)) * (1 - Math.exp(-lambdaA_FT));

            // Actualización con Alertas de Color
            updateMarket('o05-ht', p05ht, 0.70); // Alerta >= 70%
            updateMarket('o15-ht', p15ht, 0.50); // General
            updateMarket('o15-ft', p15ft, 0.80); // Alerta >= 80%
            updateMarket('o25-ft', p25ft, 0.55); // Alerta >= 55%
            updateMarket('btts', pBTTS, 0.60);   // General
        }

        function updateMarket(id, value, threshold) {
            const card = document.getElementById(`card-${id}`);
            const probText = document.getElementById(`prob-${id}`);
            const fairOddText = document.getElementById(`fair-${id}`);
            const tag = document.getElementById(`tag-${id}`);
            
            const perc = value * 100;
            probText.innerText = perc.toFixed(1) + "%";
            fairOddText.innerText = value > 0.01 ? (1 / value).toFixed(2) : "---";

            // Lógica de Alerta
            if (value >= threshold && value > 0) {
                card.classList.add('alert-active');
                if(tag) {
                    tag.innerText = "¡ALTA PROBABILIDAD!";
                    tag.className = "status-tag bg-emerald-500 text-black";
                }
                probText.style.color = "#ffffff";
            } else {
                card.classList.remove('alert-active');
                if(tag) {
                    tag.innerText = value <= 0 ? "CERRADO" : "NORMAL";
                    tag.className = "status-tag bg-white/5 text-slate-500";
                }
                // Restaurar color original según mercado
                probText.style.color = ""; 
            }

            // Opacidad si el mercado es imposible
            card.style.opacity = value <= 0 ? "0.3" : "1";
        }

        window.onload = calculateLive;
    </script>
</body>
</html>