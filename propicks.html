<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BetAGS Pro - Pro Picks</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { 
            --pro-blue: #3b82f6; 
            --deep-black: #020617; 
            --border-color: rgba(255, 255, 255, 0.05);
        }
        body { 
            background-color: var(--deep-black); 
            color: #f8fafc; 
            font-family: 'Inter', sans-serif; 
            background-image: radial-gradient(circle at top right, #1e40af20, transparent);
        }
        .glass-card { 
            background: rgba(15, 23, 42, 0.95); 
            border: 1px solid var(--border-color); 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
        }
        .excel-table { width: 100%; border-collapse: collapse; font-size: 11px; }
        .excel-table th { 
            background: #1e293b; 
            color: var(--pro-blue); 
            text-transform: uppercase; 
            padding: 12px 10px; 
            text-align: left; 
            border-bottom: 2px solid rgba(59, 130, 246, 0.3); 
        }
        .excel-table td { padding: 12px 10px; border-bottom: 1px solid rgba(255, 255, 255, 0.02); }
        .row-win { background: rgba(16, 185, 129, 0.08) !important; border-left: 4px solid #10b981; }
        .row-loss { background: rgba(239, 68, 68, 0.08) !important; border-left: 4px solid #ef4444; }
        .row-pending { background: rgba(251, 191, 36, 0.1) !important; border-left: 4px solid #fbbf24; }
        .btn-action { padding: 4px 8px; border-radius: 4px; font-weight: bold; font-size: 9px; }
        .btn-win { background: #059669; color: white; }
        .btn-loss { background: #dc2626; color: white; }
        .btn-pending { background: #d97706; color: white; }
        .scroll-custom::-webkit-scrollbar { width: 6px; height: 6px; }
        .scroll-custom::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }

        /* Estilos para la sección de rendimiento */
        .rank-item { display: flex; justify-content: space-between; align-items: center; padding: 6px 0; border-bottom: 1px solid rgba(255,255,255,0.03); }
        .rank-name { font-size: 10px; font-weight: 600; color: #94a3b8; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 120px; }
        .rank-val { font-size: 10px; font-weight: 800; }
    </style>
</head>
<body>
    <nav class="p-4 bg-black/60 border-b border-blue-500/10 backdrop-blur-md sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold tracking-tighter">BETAGS <span class="text-blue-500">PRO PICKS</span></h1>
            <div class="flex flex-wrap gap-2">
                <a href="index.html" class="px-4 py-1.5 text-xs font-semibold bg-slate-900 rounded-full border border-slate-800 transition">Poisson</a>
                <a href="roi.html" class="px-4 py-1.5 text-xs font-semibold bg-slate-900 rounded-full border border-emerald-500/30 text-emerald-400">ROI Pre</a>
                <a href="propicks.html" class="px-4 py-1.5 text-xs font-semibold bg-blue-500/20 text-blue-400 rounded-full border border-blue-500/50">Pro Picks ⭐</a>
            </div>
        </div>
    </nav>

    <div class="container mx-auto p-4 lg:p-8">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <div class="glass-card p-4 rounded-xl text-center border-blue-500/20">
                <p class="text-[10px] text-slate-500 uppercase font-bold tracking-widest mb-1">ROI Pro Profit</p>
                <p id="stat-profit" class="text-xl font-black text-white">0.00u</p>
            </div>
            <div class="glass-card p-4 rounded-xl text-center">
                <p class="text-[10px] text-slate-500 uppercase font-bold tracking-widest mb-1">Pro Yield</p>
                <p id="stat-yield" class="text-xl font-black text-blue-400">0%</p>
            </div>
            <div class="glass-card p-4 rounded-xl text-center">
                <p class="text-[10px] text-slate-500 uppercase font-bold tracking-widest mb-1">Pro Hit Rate</p>
                <p id="stat-hit" class="text-xl font-black text-emerald-400">0%</p>
            </div>
            <div class="glass-card p-4 rounded-xl text-center">
                <p class="text-[10px] text-slate-500 uppercase font-bold tracking-widest mb-1">Total Selección</p>
                <p id="stat-count" class="text-xl font-black text-white">0</p>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <div class="lg:col-span-1 space-y-6">
                <div class="glass-card p-5 rounded-2xl">
                    <p class="text-[10px] text-blue-500 font-black uppercase mb-4 text-center tracking-widest">Equity Curva de Élite</p>
                    <div class="h-[150px]">
                        <canvas id="bankrollChart"></canvas>
                    </div>
                </div>

                <div class="glass-card p-5 rounded-2xl">
                    <p class="text-[10px] text-emerald-500 font-black uppercase mb-4 tracking-widest flex items-center gap-2">
                        <i class="fa-solid fa-ranking-star"></i> Top Rendimiento
                    </p>
                    
                    <div class="space-y-4">
                        <div>
                            <p class="text-[9px] text-slate-500 font-bold uppercase mb-2 border-b border-slate-800 pb-1">Mejores Ligas</p>
                            <div id="league-ranking" class="space-y-1">
                                </div>
                        </div>

                        <div>
                            <p class="text-[9px] text-slate-500 font-bold uppercase mb-2 border-b border-slate-800 pb-1">Mejores Mercados</p>
                            <div id="market-ranking" class="space-y-1">
                                </div>
                        </div>
                    </div>

                    <div class="mt-6 pt-4 border-t border-slate-800">
                        <button onclick="clearProHistory()" class="w-full py-2 bg-transparent text-red-500 hover:bg-red-500/10 text-[10px] font-bold rounded-lg uppercase">Limpiar Selección Pro</button>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-3">
                <div class="glass-card rounded-2xl overflow-hidden shadow-2xl">
                    <div class="overflow-x-auto scroll-custom">
                        <table class="excel-table">
                            <thead>
                                <tr>
                                    <th>Evento Pro</th>
                                    <th>Mercado</th>
                                    <th>Prob %</th>
                                    <th>Casa</th>
                                    <th>VAL %</th>
                                    <th>Edge</th>
                                    <th>Stake</th>
                                    <th>Resolución</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="pro-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const PRO_STORAGE_KEY = 'betags_pro_picks';
        let proBets = JSON.parse(localStorage.getItem(PRO_STORAGE_KEY)) || [];
        let proChart;

        function updateProStats() {
            const resolved = proBets.filter(b => b.status === 'win' || b.status === 'loss');
            const sortedResolved = [...resolved].sort((a,b) => new Date(a.date) - new Date(b.date));
            
            const profit = sortedResolved.reduce((a, b) => a + (Number(b.profit) || 0), 0);
            const staked = sortedResolved.reduce((a, b) => a + (Number(b.stake) || 0), 0);
            const wins = sortedResolved.filter(b => b.status === 'win').length;
            const currentYield = staked > 0 ? (profit/staked*100) : 0;
            
            document.getElementById('stat-profit').innerText = (profit >= 0 ? "+" : "") + profit.toFixed(2) + "u";
            document.getElementById('stat-profit').className = profit >= 0 ? "text-xl font-black text-emerald-400" : "text-xl font-black text-red-400";
            document.getElementById('stat-yield').innerText = currentYield.toFixed(1) + "%";
            document.getElementById('stat-hit').innerText = (sortedResolved.length > 0 ? (wins/sortedResolved.length*100).toFixed(1) : 0) + "%";
            document.getElementById('stat-count').innerText = proBets.length;

            renderProTable();
            renderProChart(sortedResolved);
            renderRankings(resolved);
        }

        function renderRankings(resolved) {
            const leagueData = {};
            const marketData = {};

            resolved.forEach(b => {
                const league = b.teams && b.teams.includes(':') ? b.teams.split(':')[0].trim() : 'General';
                const market = b.market || 'Unknown';
                const p = Number(b.profit) || 0;

                leagueData[league] = (leagueData[league] || 0) + p;
                marketData[market] = (marketData[market] || 0) + p;
            });

            const renderList = (data, elementId) => {
                const sorted = Object.entries(data).sort((a, b) => b[1] - a[1]).slice(0, 5);
                const container = document.getElementById(elementId);
                container.innerHTML = sorted.length ? '' : '<p class="text-[9px] text-slate-700 italic">Esperando datos...</p>';
                
                sorted.forEach(([name, val]) => {
                    const color = val >= 0 ? 'text-emerald-400' : 'text-red-400';
                    container.innerHTML += `
                        <div class="rank-item">
                            <span class="rank-name">${name}</span>
                            <span class="rank-val ${color}">${val >= 0 ? '+' : ''}${val.toFixed(2)}u</span>
                        </div>
                    `;
                });
            };

            renderList(leagueData, 'league-ranking');
            renderList(marketData, 'market-ranking');
        }

        function renderProTable() {
            const tbody = document.getElementById('pro-body');
            tbody.innerHTML = proBets.length === 0 ? '<tr><td colspan="9" class="p-10 text-center text-slate-600 italic">No has exportado picks pro todavía</td></tr>' : '';
            
            const sorted = [...proBets].sort((a,b) => (new Date(b.date) - new Date(a.date)));
            
            sorted.forEach(b => {
                const tr = document.createElement('tr');
                tr.className = `row-${b.status || 'pending'}`;
                const probVal = (Number(b.prob) * 100) || 0;
                const edgeVal = parseFloat(b.edge?.toString().replace('%','')) || 0;
                const oddNum = Number(b.odd) || 0;
                const houseProb = oddNum > 0 ? (1 / oddNum) * 100 : 0;
                const valCol = probVal - houseProb;

                tr.innerHTML = `
                    <td>
                        <div class="font-bold text-slate-100">${b.teams}</div>
                        <div class="text-[9px] text-slate-500 uppercase">${b.date}</div>
                    </td>
                    <td class="font-bold text-blue-400">${b.market}</td>
                    <td class="text-slate-400">${probVal.toFixed(1)}%</td>
                    <td class="font-black text-white">${oddNum.toFixed(2)}</td>
                    <td class="font-bold text-blue-300">${valCol.toFixed(1)}%</td>
                    <td class="text-emerald-400 font-bold">${edgeVal.toFixed(1)}%</td>
                    <td class="font-bold">${b.stake}u</td>
                    <td>
                        <div class="flex gap-1">
                            <button onclick="resolvePro('${b.id}', 'win')" class="btn-action btn-win">W</button>
                            <button onclick="resolvePro('${b.id}', 'loss')" class="btn-action btn-loss">L</button>
                            <button onclick="resolvePro('${b.id}', 'pending')" class="btn-action btn-pending">P</button>
                        </div>
                    </td>
                    <td><button onclick="deletePro('${b.id}')" class="text-slate-700 hover:text-red-500 px-2"><i class="fa-solid fa-trash-can"></i></button></td>
                `;
                tbody.appendChild(tr);
            });
        }

        function resolvePro(id, status) {
            const idx = proBets.findIndex(x => x.id.toString() === id.toString());
            if(idx !== -1) {
                proBets[idx].status = status;
                const odd = Number(proBets[idx].odd) || 0;
                const stake = Number(proBets[idx].stake) || 0;
                proBets[idx].profit = status === 'win' ? stake * (odd - 1) : (status === 'loss' ? -stake : 0);
                localStorage.setItem(PRO_STORAGE_KEY, JSON.stringify(proBets));
                updateProStats();
            }
        }

        function deletePro(id) {
            if(confirm('¿Eliminar de la selección Pro?')) {
                proBets = proBets.filter(x => x.id.toString() !== id.toString());
                localStorage.setItem(PRO_STORAGE_KEY, JSON.stringify(proBets));
                updateProStats();
            }
        }

        function clearProHistory() {
            if(confirm('¿Vaciar la selección elite?')) {
                proBets = [];
                localStorage.setItem(PRO_STORAGE_KEY, JSON.stringify(proBets));
                updateProStats();
            }
        }

        function renderProChart(sorted) {
            const ctx = document.getElementById('bankrollChart').getContext('2d');
            if(proChart) proChart.destroy();
            let current = 100;
            let data = [100];
            sorted.forEach(b => { current += Number(b.profit); data.push(current); });
            proChart = new Chart(ctx, {
                type: 'line',
                data: { labels: data.map((_,i)=>i), datasets: [{ data: data, borderColor: '#3b82f6', borderWidth: 2, fill: true, tension: 0.4, pointRadius: 0, backgroundColor: 'rgba(59, 130, 246, 0.1)' }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { grid: { color: 'rgba(255,255,255,0.03)' }, ticks: { color: '#475569', font: { size: 9 } } } } }
            });
        }

        window.onload = updateProStats;
    </script>
</body>
</html>